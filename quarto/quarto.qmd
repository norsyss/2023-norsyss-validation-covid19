---
title: "A Statistical Evaluation of COVID-19 Surveillance in the Norwegian Syndromic Surveillance System (NorSySS)"
bibliography: references.bib
csl: biomed-central.csl
editor_options:
  chunk_output_type: console
---

```{r}
#| include: false
# initialize the project
# note: remember to keep in sync with run.R
project <- org::initialize_project(
  env     = .GlobalEnv,
  home    = c(
    "~/articles/2023-norsyss-statistical-evaluation-covid19",
    "~/fhi/2023-norsyss-statistical-evaluation-covid19"
  ),
  quarto  = c(
    "~/articles/2023-norsyss-statistical-evaluation-covid19/quarto",
    "~/fhi/2023-norsyss-statistical-evaluation-covid19/quarto"
  ),
  data    = c(
    "~/articles/2023-norsyss-statistical-evaluation-covid19/data",
    "~/fhi/2023-norsyss-statistical-evaluation-covid19/data"
  ),
  results = c(
    "~/articles/2023-norsyss-statistical-evaluation-covid19/results",
    "~/fhi/2023-norsyss-statistical-evaluation-covid19/results"
  ),
  folders_to_be_sourced = "R"
)

library(data.table)
library(ggplot2)
library(magrittr)

results_p1 <- readRDS(org::path(org::project$data, "results_p1.RDS"))
results_p2 <- readRDS(org::path(org::project$data, "results_p2.RDS"))
```

## Introduction

The Norwegian Syndromic Surveillance System (NorSySS) is a vital public health surveillance system designed to detect outbreaks of infectious diseases and provide early warning for implementation of necessary control measures.[@swanson2022one] As of the time of publishing, NorSySS surveils 87 ICPC-2 code combinations on a daily basis, at the national, county, and municipality level. The data

https://link.springer.com/article/10.3758/s13428-015-0611-2

## Methods

| Attribute          | Definition                                                                                              |
|--------------------|---------------------------------------------------------------------------------------------------------|
| Data quality       | Completeness and validity of the data recorded in the public health surveillance system.                |
| Sensitivity        | Ability to detect outbreaks, including the ability to monitor changes in the number of cases over time. |
| Representativeness | Accurately describing the occurrence of a health-related event over time.                               |
| Timeliness         | The speed between steps in a public health surveillance system.                                         |

: Attributes relevant to the statistical evaluation of COVID-19 surveillance in NorSySS.[@guidelines2001]

## Results

+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Indicator                                | Value                                                                                                                                                                                                                                                                                                                            |
+==========================================+==================================================================================================================================================================================================================================================================================================================================+
| Purpose and objectives                   | -   Monitor trends of COVID-19.                                                                                                                                                                                                                                                                                                  |
|                                          |                                                                                                                                                                                                                                                                                                                                  |
|                                          | -   Detect outbreaks of COVID-19                                                                                                                                                                                                                                                                                                 |
|                                          |                                                                                                                                                                                                                                                                                                                                  |
|                                          | -   Provide early warning for implementation of necessary control measures.                                                                                                                                                                                                                                                      |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Health-related event under surveillance  | COVID-19                                                                                                                                                                                                                                                                                                                         |
|                                          |                                                                                                                                                                                                                                                                                                                                  |
|                                          | -   R991: Suspected/probably COVID-19. A person who meets the clinical criteria: acute respiratory tract infection and one or more of the following symptoms: fever, cough, shortness of breath, loss of sense of smell/taste, or who is considered by a doctor to have suspected COVID-19.[@icpc2covid]                         |
|                                          |                                                                                                                                                                                                                                                                                                                                  |
|                                          | -   R992: Confirmed COVID-19. A person with coronavirus (SARS-CoV-2) confirmed by RT-PCR test, other nucleic acid amplification test or rapid antigen test (rapid immunoassay).[@icpc2covid]                                                                                                                                     |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Population under surveillance            | All people in Norway who are eligible for treatment by state-sponsored general practitioners or out-of-hours primary care facilities.                                                                                                                                                                                            |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Period of time of data collection        | -   R991: 2020-03-05 until present day.[@icpc2covid]                                                                                                                                                                                                                                                                             |
|                                          |                                                                                                                                                                                                                                                                                                                                  |
|                                          | -   R992: 2020-04-30 until present day.[@icpc2covid]                                                                                                                                                                                                                                                                             |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| What data are collected                  | Number of consultations performed by state-sponsored general practitioners or out-of-hours primary care facilities corresponding to particular ICPC-2 codes.                                                                                                                                                                     |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Reporting sources of data for the system | KUHR (Control and Payment of Health Reimbursements), which is a system that manages reimbursement claims from healthcare providers and institutions to the state (HELFO) in Norway. The system is owned by the Norwegian Directorate of Health. KUHR stores information about each patient's contact with a healthcare provider. |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Systems data analyzed                    | Using Surveillance Core 9 ("sc9"), a free and open-source framework for real-time analysis and disease surveillance.[@sc9]                                                                                                                                                                                                       |
+------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Purpose and operation of COVID-19 surveillance in NorSySS.

### Simplicity

### Flexibility

### Data quality

### Acceptability

### Sensitivity

### Predictive value positive

### Representativeness

### Timeliness

Definition: Timeliness reflects the speed between steps in a pub

### Stability

```{r}
#| echo: false
#| results: hide
file <- org::path(org::project$results_today, "plot1.png")

png(file, width = 2000, height = 2000, res = 300)
par(mfrow=c(2,2))
plot(results_p1$norsyss, main = "NorSySS (R991+R992, fe)")
plot(results_p1$hospital, main = "Hospital")
plot(results_p1$icu, main = "ICU")
plot(results_p1$death, main = "Death")
dev.off()
par(mfrow=c(1,1))
```

```{r}
#| echo: false
#| fig-cap: Partial autocorrelation plots (PACF) of four time series (NorSySS R991+R992 fe, new hospital admissions, new ICU admissions, new deaths) for all of Norway.
knitr::include_graphics(file)
```

```{r}
#| echo: false
#| fig-cap: Cross-correlation coefficients after pre-whitening between various NorSySS ICPC-2/tariff codes and hard endpoints between 2020-09 and 2023-20 for all of Norway.

file <- org::path(org::project$results_today, "plot2.png")

pd <- results_p2[
  lag >= -5 & lag <= 5 &
  time %in% "all"
  ]
pd[, y_label := paste0(icpc2group_label," (",tariffgroup_tag,")")]

q <- ggplot(
  pd,
  aes(
    y = lag_factor_reverse,
    x = tariffgroup_tag,
    fill = autocorrelation_color,
    label = autocorrelation_label_zero_for_non_sig
  )
)
q <- q + geom_tile(color = "black", lwd=0.2)
q <- q + geom_text(size = 2)
q <- q + scale_fill_manual(
  "Cross-correlation coefficients\nbetween NorSySS and hard\nendpoints after pre-whitening",
  values = c(
    "#4575b4",
    "#74add1",
    "#abd9e9",
    "#e0f3f8",
    "grey",
    "#fee090",
    "#fdae61",
    "#f46d43",
    "#d73027",
    "white"
  ),
  breaks = c(
    "-1.00 to -0.91 (Very strong)", 
    "-0.71 to -0.90 (High)", 
    "-0.41 to -0.70 (Moderate)", 
    "-0.21 to -0.40 (Weak)", 
    "-0.20 to 0.20 (Very weak)", 
    "0.21 to 0.40 (Weak)", 
    "0.41 to 0.70 (Moderate)", 
    "0.71 to 0.90 (High)", 
    "1.00 to 0.91 (Very strong)", 
    "Not significant"
  ),
  drop=F
)
q <- q + facet_grid(icpc2group_label~hard_label)
q <- q + theme_gray(base_size = 8)
q <- q + theme(legend.position = "bottom")
q <- q + guides(fill = guide_legend(nrow = 5)) 
q <- q + scale_x_discrete("NorSySS tariff group")
q <- q + scale_y_discrete("Weeks lag (+1 means NorSySS is correlated with events that occur one week later)")

csstyle::save_a4(
  q, 
  file,
  landscape = FALSE,
  scaling_factor = 0.7
)
knitr::include_graphics(file)
```

```{r}
#| echo: false
#| fig-cap: Cross-correlation coefficients after pre-whitening between NorSySS (R991+R992, fe) and hard endpoints over various time-periods (Wuhan 2020-09 to 2021-06, Alpha 2021-07 to 2021-26, Delta 2021-27 to 2021-51, Omicron 2021-52 to 2023-20, No control 2022-07 to 2023-20, All 2020-09 to 2023-20) for all of Norway.

#| fig-cap: Cross-correlation coefficients between NorSySS (R991+R992, fe) and hard endpoints after pre-whitening

file <- org::path(org::project$results_today, "plot3.png")

pd <- results_p2[
  lag >= -5 & lag <= 5 &
  icpc2group_tag == "covid19" &
  tariffgroup_tag == "fe"
  ]

q <- ggplot(
  pd,
  aes(
    x = factor(lag),
    y = time_label,
    fill = autocorrelation_color,
    label = autocorrelation_label_zero_for_non_sig
  )
)
q <- q + geom_tile(color = "black", lwd=0.2)
q <- q + geom_text(size = 3)
q <- q + scale_fill_manual(
"Cross-correlation coefficients\nbetween NorSySS and hard\nendpoints after pre-whitening",
  values = c(
    "#4575b4",
    "#74add1",
    "#abd9e9",
    "#e0f3f8",
    "grey",
    "#fee090",
    "#fdae61",
    "#f46d43",
    "#d73027",
    "white"
  ),
  breaks = c(
    "-1.00 to -0.91 (Very strong)", 
    "-0.71 to -0.90 (High)", 
    "-0.41 to -0.70 (Moderate)", 
    "-0.21 to -0.40 (Weak)", 
    "-0.20 to 0.20 (Very weak)", 
    "0.21 to 0.40 (Weak)", 
    "0.41 to 0.70 (Moderate)", 
    "0.71 to 0.90 (High)", 
    "1.00 to 0.91 (Very strong)", 
    "Not significant"
  ),
  drop=F
)
q <- q + facet_grid(hard_label~.)
q <- q + theme_gray(base_size = 8)
q <- q + theme(legend.position = "bottom")
q <- q + guides(fill = guide_legend(nrow = 5)) 
q <- q + scale_x_discrete("Weeks lag (+1 means NorSySS is correlated with events that occur one week later)")
q <- q + scale_y_discrete("Time period")
csstyle::save_a4(
  q, 
  file,
  landscape = FALSE,
  scaling_factor = 0.7
)
knitr::include_graphics(file)
```

## Discussion

## Conclusions
